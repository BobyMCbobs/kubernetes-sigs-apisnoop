<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<title>APISnoop 1.19 OKRs</title>
<meta name="author" content="ii.coop"/>
<style type="text/css">
.underline { text-decoration: underline; }
</style>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/reveal.js/css/reveal.css"/>

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/reveal.js/css/theme/sky.css" id="theme"/>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/reveal.js/lib/css/zenburn.css"/>

<!-- If the query includes 'print-pdf', include the PDF print sheet -->
<script>
    if( window.location.search.match( /print-pdf/gi ) ) {
        var link = document.createElement( 'link' );
        link.rel = 'stylesheet';
        link.type = 'text/css';
        link.href = 'https://cdn.jsdelivr.net/npm/reveal.js/css/print/pdf.css';
        document.getElementsByTagName( 'head' )[0].appendChild( link );
    }
</script>
</head>
<body>
<div class="reveal">
<div class="slides">
<section id="sec-title-slide">
<h1 class="title">APISnoop 1.19 OKRs</h1><h2 class="author">ii.coop</h2><p class="date">Created: 2020-07-22 Wed 08:42</p>
</section>

<section>
<section id="slide-org808dbc4">
<h2 id="org808dbc4">v1.19</h2>
<p>
Our goal is to not make radical changes to process or approach, but iterate on our working methods to increase velocity and output in a stable, consistent way.
</p>
</section>
</section>
<section>
<section id="slide-org8f0ae15">
<h3 id="org8f0ae15">June News</h3>
<div class="outline-text-3" id="text-org8f0ae15">
</div>
</section>
<section id="slide-orgfcbdb96">
<h4 id="orgfcbdb96"><b><b>SIG-Release 1.19 <a href="https://github.com/kubernetes/sig-release/tree/master/releases/release-1.19#timeline">Timelines</a> due to Covid</b></b></h4>
<ul>
<li>Dates <a href="https://groups.google.com/forum/?utm_medium=email&amp;utm_source=footer#!msg/kubernetes-dev/TVXhcNO3SPU/-Uj-xJP2BQAJ">may yet again slip</a>, not confirmed</li>
<li>Tests need to be in Week 15 (July 23)</li>
<li>Test Freeze Week 17 (August 6th)</li>

</ul>
</section>
<section id="slide-org8243abc">
<h4 id="org8243abc"><b><b>prow.cncf.io</b></b></h4>
<ul>
<li>Created <a href="https://github.com/cncf-infra">github.com/cncf-infra</a> org</li>
<li><a href="https://github.com/cncf-infra/prow-config">prow-config</a> has two plugins
<ul>
<li>verify-conformance-release</li>
<li>verify-conformance-tests</li>

</ul></li>
<li>Test PRs in fork of <a href="https://github.com/cncf-infra/k8s-conformance/pulls">k8s-conformance</a></li>

</ul>
</section>
<section id="slide-org9ac7908">
<h4 id="org9ac7908"><b><b>Increase in coverage for 1.19 over 1.18 Stable</b></b></h4>
<ul>
<li>Total of 41 Endpoints promoted from Beta</li>
<li>39 Endpoints promoted with test</li>
<li>2 Endpoints that came in without conformance test picked up by ii</li>
<li>14 Endpoints hit by ii Confromance tests</li>

</ul>
</section>
<section id="slide-org7122bec">
<h4 id="org7122bec"><b><b>9.61% increase in coverage since 1.18</b></b></h4>
<ul>
<li>1.18 coverage 38.86% = 150/386</li>
<li>Current 1.19 coverage: 48.47% = 207/427</li>

</ul>
</section>
<section id="slide-org6d739fa">
<h4 id="org6d739fa"><b><b>Watch Tooling Refactoring</b></b></h4>
<ul>
<li><a href="https://github.com/kubernetes/kubernetes/pull/92621/">PR #92621</a> Simplify ConfigMap lifecycle e2e test by @spiffxp</li>
<li>In Conformance Office Hours Meeting of   14 July
it was agreed to follow the approach proposed by Aaron.
The results will be evaluated as we go forward</li>

</ul>
</section>
<section id="slide-orgbd16816">
<h4 id="orgbd16816"><b><b>+29 Endpoints Backlogged by Tooling Request</b></b></h4>
<ul>
<li>Existing Test PRs: +21
<ul>
<li>Promotion  #90939 (+4)</li>
<li>Tests #90942,90988,92589 (+17)</li>

</ul></li>
<li>Triage 2 Issues: +8</li>
<li><b><b>Pushing</b></b> #90939,90942 &amp; 92589 for 1.19 (+14)</li>

</ul>
</section>
<section id="slide-org1834a4c">
<h4 id="org1834a4c"><b><b>Conformance coverage progress</b></b></h4>
<ul>
<li>@liggitt's team merged 2 Conformance Test +32 Endpoints</li>
<li>@Wojtek-t's team merged 1 conformance Test +7 Endpoints</li>
<li>ii merged 7 Conformance Tests +14 Endpoints</li>
<li>3 Promotions +21 Endpoints
<ul>
<li>1 of 4 Endpoints for Watch Tooling</li>

</ul></li>
<li>3 Test +17 Endpoints all for Watch Tooling</li>
<li>2 Issues of 8 Endpoints in Backlog for Watch Tooling</li>

</ul>
</section>
<section id="slide-org18f188c">
<h4 id="org18f188c"><b><b>Preventing further technical debt</b></b></h4>
<ul>
<li>Endpoint graduating from Beta to GA without Confromance tests is caught by the ii team in APISnoop</li>
<li>ii closed #93038 + 1 - Ingress Endpoint</li>
<li>@Wojtek-t's team working on #93296 + 1 Event Endpoint</li>

</ul>
</section>
<section id="slide-org0b81624">
<h4 id="org0b81624"><b><b>Summery</b></b></h4>
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-right" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">Status:</th>
<th scope="col" class="org-right">Endpoints</th>
<th scope="col" class="org-left">Blocked-Watch tooling</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">Promotion:</td>
<td class="org-right">21</td>
<td class="org-left">4</td>
</tr>

<tr>
<td class="org-left">Tests:</td>
<td class="org-right">17</td>
<td class="org-left">17</td>
</tr>

<tr>
<td class="org-left">Backlog:</td>
<td class="org-right">8</td>
<td class="org-left">8</td>
</tr>

<tr>
<td class="org-left"><b><b>Total Open:</b></b></td>
<td class="org-right"><b><b>47</b></b></td>
<td class="org-left"><b><b>31</b></b></td>
</tr>

<tr>
<td class="org-left">Merge:</td>
<td class="org-right">14</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left"><b><b>Total:</b></b></td>
<td class="org-right"><b><b>60</b></b></td>
<td class="org-left">&#xa0;</td>
</tr>
</tbody>
</table>

</section>
<section id="slide-org2c14d45">
<h4 id="org2c14d45"><b><b>APISnoop changes</b></b></h4>
<ul>
<li><a href="https://apisnoop.cncf.io">apisnoop.cncf.io</a> been updated
<ul>
<li>Sunburst graph at the top of the page
<ul>
<li>With data from 1.15 on wards</li>

</ul></li>
<li>Confromance progress is shown in 3 graphs
<ul>
<li>Stable Endpoint Coverage At Time of Release</li>
<li>Stable Endpoint Coverage At Time of Release (%)</li>
<li>Conformance Coverage By Release</li>

</ul></li>

</ul></li>

</ul>
</section>
<section id="slide-org6f0ffea">
<h4 id="org6f0ffea"><b><b>Historical Endpoint data</b></b></h4>
<ul>
<li>Historical Endpoint <a href="https://hackmd.io/6klrNXc7TzGuE6T_gZ9p3g?view">graphs</a>
<ul>
<li>PR <a href="https://github.com/kubernetes/community/pull/1806">#1806</a> API's promoted to GA must come with conformance tests</li>

</ul></li>

</ul>
</section>
<section id="slide-org4430304">
<h4 id="org4430304"><b><b>APISnoop now use SnoopDB.</b></b></h4>
<p>
It is now easy to run SnoopDB as one docker run command. This helps us with pipeline for updating coverage, but also makes it easy for user to spin up their own database and investigate k8s coverage.
</p>
</section>
<section id="slide-org57735f5">
<h4 id="org57735f5"><b><b>How it work:</b></b></h4>
<p>
With the SnoopDB image, you can run something as simple as <code>"docker run -p 5432:5432 snoopdb"</code>, which will create a postgres database with tables for:
</p>
<ul>
<li>the entire open api spec</li>
<li>the entire set of conformance tests</li>
<li>coverage data taken from e2e test suite runs</li>

</ul>
<p>
All of it loaded with fresh data ready to explore.
</p>
</section>
<section id="slide-orga20cad3">
<h4 id="orga20cad3"><b><b>Other enhancements:</b></b></h4>
<div class="outline-text-4" id="text-orga20cad3">
</div>
<ul class="org-ul">
<li><a id="org84cb1c8"></a>Automating the updates of our coverage jsons, updating daily through github actions pipeline<br /></li>
<li><a id="org6ca6104"></a>Listing new endpoints for this release beneath sunburst, sorted to have stable, non-conformance tested endpoints at top of list.<br /></li>
<li><a id="org7b603c3"></a>Stable Endpoint Coverage at Time Of Release(Percentage) - This graph shows the coverage ratio for each release, which better shows the work done to cover older endpoints.<br /></li>
</ul>
</section>
<section id="slide-orgaeaa38c">
<h4 id="orgaeaa38c"><b><b>NEXT UP</b></b></h4>
<div class="outline-text-4" id="text-orgaeaa38c">
</div>
<ul class="org-ul">
<li><a id="orga7ae7e7"></a>Improved styling and ux/ui for sunburst page. It's a proof of concept awaiting feedback, but we want to make it more user-friendly and discoverable<br /></li>
<li><a id="org083b524"></a>List of tests that hit an endpoint shown on sunburst, when zoomed into an endpoint. This already exists but was turned off to work out some issues with its filters, and we'll be adding it back to the site.<br /></li>
</ul>
</section>
<section id="slide-orgdd1928d">
<h4 id="orgdd1928d"><b><b>AND MORE</b></b></h4>
<div class="outline-text-4" id="text-orgdd1928d">
</div>
<ul class="org-ul">
<li><a id="org68dc4c5"></a>New Coverage showing below sunburst. This table would show existing endpoints but that are newly tested in this release.<br /></li>
<li><a id="org49e83ab"></a>Increased documentation for SnoopDB. Everything within the database is commented, but external documentation would make it far more beginner friendly, and we'll be tackling that next.<br /></li>
</ul>
</section>
</section>
<section>
<section id="slide-org161320e">
<h3 id="org161320e">Gate cncf/k8s-conformance PRs</h3>
<ul>
<li><a href="https://github.com/cncf/apisnoop/projects/29">cncf/k8s-conformance project board</a></li>

</ul>
</section>
<section id="slide-org18b8620">
<h4 id="org18b8620">KR1 Setup prow.cncf.io</h4>
<ul>
<li class="on"><code>[X]</code> DNS prow.cncf.io pointing to prow.apisnoop.io</li>
<li class="on"><code>[X]</code> Grant cncf-ci bot permissions to cncf github org</li>
<li class="on"><code>[X]</code> Deploy prow onto prow.cncf.io</li>
<li class="on"><code>[X]</code> Researching the isolation / clusters used by test-infra / k8s-infra-wg</li>
<li class="off"><code>[&#xa0;]</code> Look into setting up #wg-cncf-infra if there is interest</li>

</ul>
</section>
<section id="slide-org84afa8c">
<h4 id="org84afa8c">KR2 Connect cncf/k8s-conformance to prow.cncf.io</h4>
<ul>
<li class="on"><code>[X]</code> Comments and admin actions from prow.cncf.io</li>
<li class="on"><code>[X]</code> Will be made using the <a href="https://github.com/cncf-ci">cncf-ci</a> bot/github account.</li>
<li class="on"><code>[X]</code> Enable <a href="https://github.com/cncf/k8s-conformance/pull/971">meow</a> and simple prow bot plugins</li>

</ul>
</section>
<section id="slide-org31382fc">
<h4 id="org31382fc">KR3 gate+comment</h4>
<ul>
<li>Verify Release
-[X] <b><b>release-X.Y</b></b>
-[X] <b><b>needs-release</b></b> w/ Comments</li>
<li>Verify Tests
<ul>
<li><b><b>tests-run-X.Y</b></b></li>
<li><b><b>needs-tests</b></b> w/ Comments</li>

</ul></li>

</ul>
</section>
<section id="slide-org696a8ef">
<h4 id="org696a8ef">Verify Release</h4>
<ul>
<li class="on"><code>[X]</code> PR Title</li>
<li class="on"><code>[X]</code> Folder</li>
<li class="on"><code>[X]</code> e2e.log</li>
<li class="trans"><code>[-]</code> junit.xml</li>
<li class="on"><code>[X]</code> PRODUCT.yaml has all required fields</li>
<li class="on"><code>[X]</code> add <b><b>needs-release</b></b> OR <b><b>release-X.Y</b></b></li>

</ul>
</section>
<section id="slide-org054e5c1">
<h4 id="org054e5c1">Verify Tests</h4>
<ul>
<li class="on"><code>[X]</code> List of tests required for release</li>
<li class="on"><code>[X]</code> List of tests from junit.xml and compare with requiered test</li>
<li class="on"><code>[X]</code> Comfirm that e2e Log have no failed tests</li>
<li class="on"><code>[X]</code> Comment list/count of missing tests</li>
<li class="on"><code>[X]</code> add <b><b>needs-tests</b></b> OR <b><b>tests-run-X.Y</b></b></li>

</ul>
</section>
<section id="slide-orgd6caccd">
<h4 id="orgd6caccd">definition Informed by <a href="https://github.com/kubernetes/enhancements/blob/2c19ec7627e326d1c75306dcaa3d2f14002301fa/keps/sig-architecture/960-conformance-behaviors/README.md#role-cncf-conformance-program">user stories for KEP-960</a></h4>
<pre class="example">
Must confirm the version of the tests being run matches...
Must confirm the set of tests being run matches...
Must confirm all behaviors are covered by a test...
</pre>
</section>
</section>
<section>
<section id="slide-org8d1720d">
<h3 id="org8d1720d">Gate k/k PRs touching test/e2e or API</h3>
<ul>
<li><a href="https://github.com/cncf/apisnoop/projects/30">k/k API+Conformance Gate</a></li>

</ul>
</section>
<section id="slide-orga54929b">
<h4 id="orga54929b">Background</h4>
<p>
Influenced by <a href="https://github.com/kubernetes/enhancements/pull/1666/files?short_path=92a9412#diff-92a9412ae55358378bc66295cdbea103">Behavior KEP user stories</a> while continuing to focus on endpoints!
</p>

<blockquote>
<p>
Will show increase in endpoints, and tested endpoints, but also, explicitly, whether conformance coverage increased.
</p>
</blockquote>

<blockquote>
<p>
Comment: "you are adding a new endpoint to stable, and you are adding a conformance test for it"
</p>
</blockquote>
</section>
<section id="slide-org97d9923">
<h4 id="org97d9923">OKing PR</h4>
<blockquote>
<p>
Existing responsiblity via owners file ensures that PRs touching swagger or conformance tests are <b><b>/approved</b></b> by right people.
</p>
</blockquote>

<blockquote>
<p>
A label of <b><b>requires-conformance</b></b> will applied, and <b><b>conformance</b></b> label will need to be added by this gate + automation.
</p>
</blockquote>
</section>
<section id="slide-org477aac9">
<h4 id="org477aac9">KR1 Identify a PR as requiring conformance review</h4>
<p>
PR must touch file in conformance-specific directory
</p>

<ul>
<li>(initially /area-conformance + /sig-arch)</li>
<li class="off"><code>[&#xa0;]</code> Create <code>run_if_changed</code> presubmit</li>

</ul>

<pre class="example">
eg: update test/conformance/behaviors/..
eg: mv from test/e2e to test/conformance
</pre>
</section>
<section id="slide-org926be8c">
<h4 id="org926be8c">KR2 Identify list of endpoints added/removed</h4>
<p>
Tooling will compare <code>path/operation_id</code> in <code>api/openapi-spec/swagger.json</code>
</p>
<ul>
<li class="off"><code>[&#xa0;]</code> Generate list of new endpoints</li>
<li class="off"><code>[&#xa0;]</code> Generate list of removed endpoints</li>

</ul>
</section>
<section id="slide-org07e9846">
<h4 id="org07e9846">KR3 Run APISnoop against PR to generate endpoint coverage</h4>
<p>
Tooling will provide a list of tested and conformant endpoints.
</p>
<ul>
<li class="off"><code>[&#xa0;]</code> Wait for main prow job to finish</li>
<li class="off"><code>[&#xa0;]</code> Generate list of hit/tested endpoints</li>
<li class="off"><code>[&#xa0;]</code> Generate list of conformant endpoints</li>

</ul>
</section>
<section id="slide-orgefba0ea">
<h4 id="orgefba0ea">KR4 bot comment w/ list of increase/decrease of endpoints</h4>
<p>
Tooling will comment directly on PR
</p>

<ul>
<li class="off"><code>[&#xa0;]</code> alpha : endpoints needing tests</li>
<li class="off"><code>[&#xa0;]</code> beta : endpoints needing tests</li>
<li class="off"><code>[&#xa0;]</code> stable : comment+block via tag</li>

</ul>

<blockquote>
<p>
You've added api's without tests it will not be able to reach stable.
</p>
</blockquote>
</section>
<section id="slide-orgc2459bb">
<h4 id="orgc2459bb">KR5 Manual Approval for SIG-Arch (or appropriate owners)</h4>
<p>
Ensure the API Review process has been followed.
</p>

<ul>
<li class="off"><code>[&#xa0;]</code> Get feedback on approval process from SIG-Arch</li>
<li class="off"><code>[&#xa0;]</code> Ensure the correct tagging / OWNERS are respected</li>

</ul>
</section>
<section id="slide-org27b2218">
<h4 id="org27b2218">KR6 Donate APISnoop to sig-arch</h4>
<ul>
<li class="off"><code>[&#xa0;]</code> Get feedback if this is desired</li>
<li class="off"><code>[&#xa0;]</code> Get as to location of repo under k8s org</li>
<li class="off"><code>[&#xa0;]</code> Migration maybe in Q4</li>

</ul>
</section>
</section>
<section>
<section id="slide-org2416c4b">
<h3 id="org2416c4b">Increase Stable Test Coverage by 40 endpoints</h3>
<div class="outline-text-3" id="text-org2416c4b">
</div>
</section>
<section id="slide-org56620ce">
<h4 id="org56620ce"><b><b>KR1 (14/40) new conformant stable endpoints</b></b></h4>
<ul>
<li>#89753 + 5 points</li>
<li>#90390 + 3 points</li>
<li>#90812 + 1 point</li>
<li>#90941 + 2 points</li>
<li>#92813 + 1 point</li>
<li>#93084 + 1 point</li>
<li>#93038 + 1 point Ingress Endpoint</li>

</ul>
</section>
<section id="slide-orgcb5b0c2">
<h4 id="orgcb5b0c2"><b><b>What is in the numbers</b></b></h4>
<ul>
<li>14 Endpoints by ii</li>
<li>39 Endpoints by the community</li>

</ul>
<p>
Total: 53
</p>
<ul>
<li>21 Promotion Endpoints by ii</li>
<li>17 Watch tooling test Endpoints by ii</li>

</ul>
<p>
Total: 38
<b><b>Grand total possible: 91</b></b>
</p>
</section>
<section id="slide-orgacd5478">
<h4 id="orgacd5478"><b><b>KR2 (9.61% / +9%) Coverage Increase</b></b></h4>
<p>
<b><b>38.86%-&gt;48.47%</b></b>
</p>
<ul>
<li>Target have been exceeded with ii and the community's effort</li>
<li>Further increase expected before 1.19 test freeze</li>
<li>Due to increase in total endpoints, our increase may be hidden.</li>

</ul>
<p>
Percentage many not be a clear indicator.
</p>
</section>
<section id="slide-org62a4dd4">
<h4 id="org62a4dd4"><b><b>KR3 (stretch +49) 50% stable endpoints hit by conformance tests</b></b></h4>
<ul>
<li>Possible, only need Conformance tests for 7 more Endpoints to Merge</li>

</ul>
</div>
</div>
<script src="https://cdn.jsdelivr.net/npm/reveal.js/lib/js/head.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/reveal.js/js/reveal.js"></script>
<script>
// Full list of configuration options available here:
// https://github.com/hakimel/reveal.js#configuration
Reveal.initialize({

controls: true,
progress: true,
history: false,
center: true,
slideNumber: 'c',
rollingLinks: false,
keyboard: true,
mouseWheel: false,
fragmentInURL: false,
hashOneBasedIndex: false,
pdfSeparateFragments: true,

overview: true,
margin: 0.10,
minScale: 0.20,
maxScale: 3.50,

theme: Reveal.getQueryHash().theme, // available themes are in /css/theme
transition: Reveal.getQueryHash().transition || 'cube', // see README of reveal.js for options
transitionSpeed: '1',
multiplex: {
    secret: '', // null if client
    id: '', // id, obtained from socket.io server
    url: 'https://reveal-js-multiplex-ccjbegmaii.now.sh' // Location of socket.io server
},

// Optional libraries used to extend reveal.js
dependencies: [
 { src: 'https://cdn.jsdelivr.net/npm/reveal.js/plugin/markdown/marked.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
 { src: 'https://cdn.jsdelivr.net/npm/reveal.js/plugin/markdown/markdown.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
 { src: 'https://cdn.jsdelivr.net/npm/reveal.js/plugin/notes/notes.js', async: true, condition: function() { return !!document.body.classList; } },
 { src: 'https://cdn.jsdelivr.net/npm/reveal.js/plugin/highlight/highlight.js', async: true, callback: function() { hljs.initHighlightingOnLoad(); } },
 { src: 'https://cdn.socket.io/socket.io-1.3.5.js', async: true },
 { src: 'https://cdn.jsdelivr.net/npm/reveal.js/plugin/multiplex/master.js', async: true }]

});
</script>
</body>
</html>
